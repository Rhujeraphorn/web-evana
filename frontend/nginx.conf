server {
    # บล็อก server เดียว เปิดฟังที่พอร์ต 80 สำหรับ reverse proxy / static site
    listen 80;
    server_name _; # ใช้ wildcard ให้รับทุก host name (สะดวกสำหรับ container)

    root /usr/share/nginx/html; # โฟลเดอร์ที่ Next.js build แบบ export หรือ output.static จะถูกคัดลอกมา
    index index.html;           # เสิร์ฟไฟล์นี้เป็นหน้าหลัก

    # แคช asset ของ Next.js (ไฟล์ hash แล้ว) ได้นานเพื่อประหยัด bandwidth
    location /_next/static/ {
        alias /usr/share/nginx/html/_next/static/;
        add_header Cache-Control "public, max-age=31536000, immutable";
    }

    # fallback SPA routing: ถ้าไม่พบไฟล์ ให้ส่ง index.html ไปให้ Next.js/React handle ที่ client
    location / {
        try_files $uri $uri/ /index.html;
    }
}
